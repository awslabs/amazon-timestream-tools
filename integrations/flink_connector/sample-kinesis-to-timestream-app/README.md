# Amazon Timestream Sink for Apache Flink Sample Application

This sample application demonstrates how you can use Amazon Timestream Sink. It contains data models to deserialize data generated by [python sample data generator](../sample-data-generator), as well as Flink StreamingJob, which reads the records from Kinesis and writes them to Timestream using Timestream Sink.


## Getting started

See [parent readme](../).


## Sample Application Design

Upon launch of the `com.amazonaws.samples.kinesis2timestream.StreamingJob#main` function, _TimestreamInitializer_ creates target Timestream database/table if they do not exist.

Next, Flink Streaming environment is created, which processes the records from Kinesis Stream specified by _InputStreamName_.

Kinesis Stream contains objects generated by [python sample data generator](../sample-data-generator). You can adjust the data model in the _model_ directory according to your use case. The _model_ directory contains:
* **MyHostEvents**: a JSON serializable class to represent generated **event record**
* **MyHostMetrics**: a JSON serializable class to represent generated **metrics record**
* **TimestreamRecordConverter**: converts JSON classes to Timestream Records
* **TimestreamRecordDeserializer**: deserializes bytes to Timestream Record using a **TimestreamRecordConverter**

Check `com.amazonaws.samples.kinesis2timestream.StreamingJob#main` for configuration details.

For configuration settings related to Timestream sink, please check [flink-connector-timestream](../flink-connector-timestream).

## Running the sample application locally

To compile and package this application, run:
```
mvn clean compile && mvn package
```

You can run the application on your local environment by running `StreamingJobs` class:
```
mvn install exec:java -Dexec.mainClass="com.amazonaws.samples.kinesis2timestream.StreamingJob" -Dexec.args="--InputStreamName TimestreamTestStream --Region us-east-1 --TimestreamDbName kdaflink --TimestreamTableName kinesisdata" -Dexec.classpathScope=test
```

In another terminal, concurrently, run the [python sample data generator](../sample-data-generator).